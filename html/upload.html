<?
include "upgrade.tbh"
include "global.tbh"
dim s, method, value, baud as string
s=sock.httprqstring
sys.debugprint("sock.httprqstring = " + s + "\r\n")
dim num_of_files as byte=0
dim b as byte=instr(1,s,"method=",1)
sock.gethttprqstring(b+6)
s=sock.httprqstring
b=instr(1,s,"&value=",1)
method = sock.gethttprqstring(b-1)
sock.gethttprqstring(7)
s=sock.httprqstring
b=instr(1,s,"&baud=",1)
value = sock.gethttprqstring(b-1)
b=instr(1,s," HTTP/1.1",1)
baud = sock.gethttprqstring(b-1)
baud = right(baud,len(baud)-6)

if method="web" then
	sys.debugprint(value)
	start_dns(value)
else if method="wifi" then
	init_receive_socket(method)
	device_firmware_upload_async(PL_FW_UPG_SOCK, 0)
	upload_started=true
else if method="ethernet" then
	init_receive_socket(method)
	device_firmware_upload_async(PL_FW_UPG_SOCK, 0)
	upload_started=true
else if method="ser" then
	init_serial(value, baud)
	value=val(value)-1
	device_firmware_upload_async(PL_FW_UPG_SER, value)
	upload_started=true
else if method="ble" then
	device_firmware_upload_async(PL_FW_UPG_BLE, 0)
	upload_started=true
end if

?>